<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Metric Measurement Technologies</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --background: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background-color: var(--background);
      color: var(--text);
      min-height: 100vh;
    }

    /* Layout */
    .app-container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: var(--card);
      border-right: 1px solid var(--border);
      padding: 24px 16px;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 0 12px;
      margin-bottom: 32px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 18px;
    }

    .logo-text {
      font-weight: 700;
      font-size: 18px;
      color: var(--text);
    }

    .nav-menu {
      list-style: none;
    }

    .nav-item {
      margin-bottom: 4px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: 8px;
      color: var(--text-muted);
      text-decoration: none;
      font-weight: 500;
      transition: all 0.2s;
      cursor: pointer;
    }

    .nav-link:hover {
      background: var(--background);
      color: var(--text);
    }

    .nav-link.active {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
    }

    .nav-link svg {
      width: 20px;
      height: 20px;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 260px;
      padding: 32px;
    }

    /* Page Header */
    .page-header {
      margin-bottom: 32px;
    }

    .page-header h1 {
      font-size: 28px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 8px;
    }

    .page-header p {
      color: var(--text-muted);
      font-size: 15px;
    }

    .page-header-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Cards */
    .card {
      background: var(--card);
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 24px;
      margin-bottom: 24px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 16px;
    }

    /* Stat Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--card);
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 24px;
      display: flex;
      align-items: flex-start;
      gap: 16px;
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(59, 130, 246, 0.1);
      color: var(--primary);
    }

    .stat-icon.success {
      background: rgba(34, 197, 94, 0.1);
      color: var(--success);
    }

    .stat-icon.warning {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
    }

    .stat-content h3 {
      font-size: 28px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 4px;
    }

    .stat-content p {
      color: var(--text-muted);
      font-size: 14px;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
      font-family: inherit;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
    }

    .btn-primary:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--background);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 13px;
    }

    /* Tables */
    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 14px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    th {
      font-weight: 600;
      color: var(--text-muted);
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background: var(--background);
    }

    td {
      color: var(--text);
      font-size: 14px;
    }

    tr:hover td {
      background: var(--background);
    }

    /* Forms */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 8px;
      font-size: 14px;
    }

    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--card);
      border-radius: 16px;
      padding: 32px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      transform: translateY(20px);
      transition: transform 0.3s;
    }

    .modal-overlay.active .modal {
      transform: translateY(0);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-muted);
    }

    /* Badge */
    .badge {
      display: inline-flex;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .badge-success {
      background: rgba(34, 197, 94, 0.1);
      color: var(--success);
    }

    .badge-warning {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
    }

    .badge-danger {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
    }

    /* Quick Actions */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }

    .quick-action-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quick-action-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .quick-action-card h4 {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .quick-action-card p {
      font-size: 13px;
      color: var(--text-muted);
    }

    /* Sales Page */
    .sales-layout {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 24px;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .cart-summary {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 2px solid var(--border);
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .summary-row.total {
      font-size: 18px;
      font-weight: 700;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    /* Invoice */
    .invoice {
      background: white;
      padding: 40px;
      max-width: 800px;
      margin: 0 auto;
    }

    .invoice-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border);
    }

    .invoice-title {
      font-size: 32px;
      font-weight: 700;
      color: var(--primary);
    }

    .invoice-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      margin-bottom: 40px;
    }

    .invoice-section h4 {
      font-size: 12px;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    /* Quantity Controls */
    .qty-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .qty-btn {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--background);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .qty-btn:hover {
      background: var(--border);
    }

    /* Pages - Hidden by default */
    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--text);
      color: white;
      padding: 16px 24px;
      border-radius: 8px;
      font-weight: 500;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s;
      z-index: 2000;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast.success {
      background: var(--success);
    }

    /* Print Styles */
    @media print {
      .sidebar, .page-header-actions, .btn {
        display: none !important;
      }
      .main-content {
        margin-left: 0;
        padding: 0;
      }
      .invoice {
        box-shadow: none;
        border: none;
      }
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .sales-layout {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        z-index: 100;
      }
      .main-content {
        margin-left: 0;
      }
      .form-row {
        grid-template-columns: 1fr;
      }
      .invoice-details {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <div class="logo-icon">M</div>
        <span class="logo-text">Metric</span>
      </div>
      <nav>
        <ul class="nav-menu">
          <li class="nav-item">
            <a class="nav-link active" onclick="showPage('home')">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
              Home
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" onclick="showPage('customers')">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              Customers
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" onclick="showPage('products')">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>
              Products
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" onclick="showPage('sales')">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
              Sales
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" onclick="showPage('billing')">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
              Billing
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" onclick="showPage('reports')">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
              Reports
            </a>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- HOME PAGE -->
      <div id="page-home" class="page active">
        <div class="page-header">
          <h1>Dashboard</h1>
          <p>Welcome to Metric Measurement Technologies</p>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
            </div>
            <div class="stat-content">
              <h3 id="stat-customers">0</h3>
              <p>Total Customers</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon success">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/></svg>
            </div>
            <div class="stat-content">
              <h3 id="stat-products">0</h3>
              <p>Products</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon warning">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
            </div>
            <div class="stat-content">
              <h3 id="stat-stock">0</h3>
              <p>Items in Stock</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
            </div>
            <div class="stat-content">
              <h3 id="stat-revenue">$0</h3>
              <p>Total Revenue</p>
            </div>
          </div>
        </div>

        <div class="quick-actions">
          <div class="quick-action-card" onclick="showPage('customers'); openModal('customer-modal')">
            <h4>+ Add Customer</h4>
            <p>Register a new customer</p>
          </div>
          <div class="quick-action-card" onclick="showPage('products'); openModal('product-modal')">
            <h4>+ Add Product</h4>
            <p>Add new inventory item</p>
          </div>
          <div class="quick-action-card" onclick="showPage('sales')">
            <h4>+ New Sale</h4>
            <p>Create a new order</p>
          </div>
          <div class="quick-action-card" onclick="showPage('reports')">
            <h4>View Reports</h4>
            <p>Check analytics</p>
          </div>
        </div>

        <div class="card">
          <h3 class="card-title">Recent Sales</h3>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Customer</th>
                  <th>Items</th>
                  <th>Total</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody id="recent-sales-table"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- CUSTOMERS PAGE -->
      <div id="page-customers" class="page">
        <div class="page-header">
          <div class="page-header-actions">
            <div>
              <h1>Customers</h1>
              <p>Manage your customer database</p>
            </div>
            <button class="btn btn-primary" onclick="openModal('customer-modal')">+ Add Customer</button>
          </div>
        </div>

        <div class="card">
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Customer ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Address</th>
                </tr>
              </thead>
              <tbody id="customers-table"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- PRODUCTS PAGE -->
      <div id="page-products" class="page">
        <div class="page-header">
          <div class="page-header-actions">
            <div>
              <h1>Products / Stock</h1>
              <p>Manage your inventory</p>
            </div>
            <button class="btn btn-primary" onclick="openModal('product-modal')">+ Add Product</button>
          </div>
        </div>

        <div class="card">
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Product ID</th>
                  <th>Product Name</th>
                  <th>Price</th>
                  <th>Quantity</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="products-table"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- SALES PAGE -->
      <div id="page-sales" class="page">
        <div class="page-header">
          <h1>Create Sale</h1>
          <p>Generate a new order</p>
        </div>

        <div class="sales-layout">
          <div class="card">
            <h3 class="card-title">Order Details</h3>
            
            <div class="form-group">
              <label class="form-label">Select Customer *</label>
              <select id="sale-customer" class="form-select">
                <option value="">Choose a customer...</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Add Products</label>
              <div class="form-row">
                <select id="sale-product" class="form-select">
                  <option value="">Select product...</option>
                </select>
                <div style="display: flex; gap: 8px;">
                  <input type="number" id="sale-qty" class="form-input" placeholder="Qty" min="1" value="1" style="width: 80px;">
                  <button class="btn btn-primary" onclick="addToCart()">Add</button>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <h3 class="card-title">Cart</h3>
            <div id="cart-items"></div>
            <div class="cart-summary" id="cart-summary" style="display: none;">
              <div class="summary-row">
                <span>Subtotal</span>
                <span id="cart-subtotal">$0.00</span>
              </div>
              <div class="summary-row">
                <span>Tax (9%)</span>
                <span id="cart-tax">$0.00</span>
              </div>
              <div class="summary-row total">
                <span>Total</span>
                <span id="cart-total">$0.00</span>
              </div>
              <button class="btn btn-success" style="width: 100%; margin-top: 16px;" onclick="createOrder()">Generate Order</button>
            </div>
          </div>
        </div>
      </div>

      <!-- BILLING PAGE -->
      <div id="page-billing" class="page">
        <div class="page-header">
          <div class="page-header-actions">
            <div>
              <h1>Billing / Invoice</h1>
              <p>Generate and print invoices</p>
            </div>
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-secondary" onclick="window.print()">Print Invoice</button>
              <button class="btn btn-primary" onclick="saveInvoice()">Save Invoice</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="form-group">
            <label class="form-label">Select Order</label>
            <select id="invoice-order" class="form-select" onchange="loadInvoice()">
              <option value="">Choose an order...</option>
            </select>
          </div>
        </div>

        <div id="invoice-container" style="display: none;">
          <div class="invoice card">
            <div class="invoice-header">
              <div>
                <div class="invoice-title">INVOICE</div>
                <p style="color: var(--text-muted); margin-top: 4px;">Metric Measurement Technologies</p>
              </div>
              <div style="text-align: right;">
                <div style="font-weight: 600; font-size: 18px;" id="inv-id"></div>
                <div style="color: var(--text-muted);" id="inv-date"></div>
              </div>
            </div>

            <div class="invoice-details">
              <div class="invoice-section">
                <h4>Bill To</h4>
                <div id="inv-customer"></div>
              </div>
              <div class="invoice-section">
                <h4>From</h4>
                <div>Metric Measurement Technologies</div>
                <div style="color: var(--text-muted);">123 Industrial Park</div>
                <div style="color: var(--text-muted);">New York, NY 10001</div>
              </div>
            </div>

            <table>
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Qty</th>
                  <th>Price</th>
                  <th style="text-align: right;">Total</th>
                </tr>
              </thead>
              <tbody id="inv-items"></tbody>
            </table>

            <div style="max-width: 300px; margin-left: auto; margin-top: 24px;">
              <div class="summary-row">
                <span>Subtotal</span>
                <span id="inv-subtotal"></span>
              </div>
              <div class="summary-row">
                <span>Tax (9%)</span>
                <span id="inv-tax"></span>
              </div>
              <div class="summary-row total">
                <span>Total</span>
                <span id="inv-total"></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- REPORTS PAGE -->
      <div id="page-reports" class="page">
        <div class="page-header">
          <h1>Reports</h1>
          <p>Analytics and insights</p>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
            </div>
            <div class="stat-content">
              <h3 id="report-total-sales">$0</h3>
              <p>Total Sales</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon success">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="5" x="2" y="3" rx="1"/><path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8"/></svg>
            </div>
            <div class="stat-content">
              <h3 id="report-total-stock">0</h3>
              <p>Total Stock Left</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon warning">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/></svg>
            </div>
            <div class="stat-content">
              <h3 id="report-total-orders">0</h3>
              <p>Total Orders</p>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 class="card-title">Customer-wise Sales</h3>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Customer</th>
                  <th>Orders</th>
                  <th>Total Spent</th>
                </tr>
              </thead>
              <tbody id="customer-sales-table"></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <h3 class="card-title">Stock Summary</h3>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Price</th>
                  <th>Quantity</th>
                  <th>Stock Value</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="stock-summary-table"></tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Customer Modal -->
  <div id="customer-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Add Customer</h2>
        <button class="modal-close" onclick="closeModal('customer-modal')">&times;</button>
      </div>
      <form id="customer-form" onsubmit="addCustomer(event)">
        <div class="form-group">
          <label class="form-label">Name *</label>
          <input type="text" class="form-input" id="cust-name" required>
        </div>
        <div class="form-group">
          <label class="form-label">Email *</label>
          <input type="email" class="form-input" id="cust-email" required>
        </div>
        <div class="form-group">
          <label class="form-label">Phone *</label>
          <input type="tel" class="form-input" id="cust-phone" required>
        </div>
        <div class="form-group">
          <label class="form-label">Address</label>
          <textarea class="form-textarea" id="cust-address" rows="3"></textarea>
        </div>
        <button type="submit" class="btn btn-primary" style="width: 100%;">Add Customer</button>
      </form>
    </div>
  </div>

  <!-- Product Modal -->
  <div id="product-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Add Product</h2>
        <button class="modal-close" onclick="closeModal('product-modal')">&times;</button>
      </div>
      <form id="product-form" onsubmit="addProduct(event)">
        <div class="form-group">
          <label class="form-label">Product Name *</label>
          <input type="text" class="form-input" id="prod-name" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Price *</label>
            <input type="number" class="form-input" id="prod-price" step="0.01" min="0" required>
          </div>
          <div class="form-group">
            <label class="form-label">Quantity *</label>
            <input type="number" class="form-input" id="prod-qty" min="0" required>
          </div>
        </div>
        <button type="submit" class="btn btn-primary" style="width: 100%;">Add Product</button>
      </form>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <script>
    // Data Storage
    let customers = [];

    let products = [
      { id: 'PROD001', name: 'Digital Caliper Pro', price: 89.99, quantity: 45, createdAt: '2024-01-01' },
      { id: 'PROD002', name: 'Precision Micrometer Set', price: 249.99, quantity: 23, createdAt: '2024-01-05' },
      { id: 'PROD003', name: 'Laser Distance Meter', price: 179.99, quantity: 67, createdAt: '2024-01-10' }
    ];

    let sales = [
      {
        id: 'ORD001',
        customerId: 'CUST001',
        customerName: 'Acme Industries',
        items: [
          { productId: 'PROD001', productName: 'Digital Caliper Pro', quantity: 5, price: 89.99, total: 449.95 },
          { productId: 'PROD002', productName: 'Precision Micrometer Set', quantity: 2, price: 249.99, total: 499.98 }
        ],
        subtotal: 949.93,
        tax: 85.49,
        total: 1035.42,
        createdAt: '2024-03-01'
      }
    ];

    let cart = [];

    // Utility Functions
    function generateId(prefix) {
      return prefix + Math.random().toString(36).substring(2, 7).toUpperCase();
    }

    function formatCurrency(amount) {
      return '$' + amount.toFixed(2);
    }

    function formatDate(date) {
      return new Date(date).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
    }

    function showToast(message, type = '') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast show ' + type;
      setTimeout(() => toast.className = 'toast', 3000);
    }

    // Navigation
    function showPage(pageName) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
      
      document.getElementById('page-' + pageName).classList.add('active');
      event.target.closest('.nav-link')?.classList.add('active') || 
        document.querySelector(`[onclick="showPage('${pageName}')"]`).classList.add('active');
      
      refreshData();
    }

    // Modal Functions
    function openModal(modalId) {
      document.getElementById(modalId).classList.add('active');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }
    async function addCustomer(e) {
    e.preventDefault();
    
    const formData = new URLSearchParams();
    // These names ('name', 'email', etc.) MUST match your Java getParameter names
    formData.append('name', document.getElementById('cust-name').value);
    formData.append('email', document.getElementById('cust-email').value);
    formData.append('phone', document.getElementById('cust-phone').value);
    formData.append('address', document.getElementById('cust-address').value);

    try {
        const response = await fetch('CustomerServlet', {
            method: 'POST',
            body: formData
        });

        if (response.ok) {
            showToast('Customer added successfully!', 'success');
            closeModal('customer-modal');
            document.getElementById('customer-form').reset();
            fetchCustomers(); // This refreshes the table immediately
        } else {
            throw new Error("Failed to save");
        }
    } catch (error) {
        showToast('Error saving to database', 'danger');
    }
}

    // Customer Functions
async function fetchCustomers() {
    try {
        const response = await fetch('CustomerServlet'); // Calls your @WebServlet
        const data = await response.json(); // Gets the data from Java
        
        const tbody = document.getElementById('customers-table');
        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5">No data in database.</td></tr>';
        } else {
            // This maps your database columns to the HTML table
        // Ensure your table rendering logic uses the keys from your Java Map
      tbody.innerHTML = data.map(c => `
    <tr>
        <td><strong>${c.id}</strong></td> 
        <td>${c.name}</td>
        <td>${c.email}</td>
        <td>${c.phone}</td>
        <td>${c.address}</td>
    </tr>
`).join('');
        }
    } catch (error) {
        console.error("Connection failed:", error);
    }
}
    // Product Functions
    function addProduct(e) {
      e.preventDefault();
      const product = {
        id: generateId('PROD'),
        name: document.getElementById('prod-name').value,
        price: parseFloat(document.getElementById('prod-price').value),
        quantity: parseInt(document.getElementById('prod-qty').value),
        createdAt: new Date().toISOString()
      };
      products.push(product);
      document.getElementById('product-form').reset();
      closeModal('product-modal');
      showToast('Product added successfully!', 'success');
      refreshData();
    }

    function updateQuantity(productId, delta) {
      const product = products.find(p => p.id === productId);
      if (product) {
        product.quantity = Math.max(0, product.quantity + delta);
        refreshData();
      }
    }

    function renderProducts() {
      const tbody = document.getElementById('products-table');
      tbody.innerHTML = products.map(p => {
        let status = 'badge-success';
        let statusText = 'In Stock';
        if (p.quantity === 0) {
          status = 'badge-danger';
          statusText = 'Out of Stock';
        } else if (p.quantity < 10) {
          status = 'badge-warning';
          statusText = 'Low Stock';
        }
        return `
          <tr>
            <td><strong>${p.id}</strong></td>
            <td>${p.name}</td>
            <td>${formatCurrency(p.price)}</td>
            <td>${p.quantity}</td>
            <td><span class="badge ${status}">${statusText}</span></td>
            <td>
              <div class="qty-controls">
                <button class="qty-btn" onclick="updateQuantity('${p.id}', -1)">−</button>
                <span>${p.quantity}</span>
                <button class="qty-btn" onclick="updateQuantity('${p.id}', 1)">+</button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    // Sales Functions
    function populateSalesDropdowns() {
      const customerSelect = document.getElementById('sale-customer');
      customerSelect.innerHTML = '<option value="">Choose a customer...</option>' + 
        customers.map(c => `<option value="${c.id}">${c.name}</option>`).join('');

      const productSelect = document.getElementById('sale-product');
      productSelect.innerHTML = '<option value="">Select product...</option>' + 
        products.filter(p => p.quantity > 0).map(p => 
          `<option value="${p.id}">${p.name} - ${formatCurrency(p.price)} (${p.quantity} in stock)</option>`
        ).join('');
    }

    function addToCart() {
      const productId = document.getElementById('sale-product').value;
      const qty = parseInt(document.getElementById('sale-qty').value);
      
      if (!productId || !qty) {
        showToast('Please select a product and quantity');
        return;
      }

      const product = products.find(p => p.id === productId);
      if (qty > product.quantity) {
        showToast('Not enough stock available');
        return;
      }

      const existingItem = cart.find(item => item.productId === productId);
      if (existingItem) {
        if (existingItem.quantity + qty > product.quantity) {
          showToast('Not enough stock available');
          return;
        }
        existingItem.quantity += qty;
        existingItem.total = existingItem.quantity * existingItem.price;
      } else {
        cart.push({
          productId: product.id,
          productName: product.name,
          quantity: qty,
          price: product.price,
          total: qty * product.price
        });
      }

      document.getElementById('sale-qty').value = 1;
      renderCart();
    }

    function removeFromCart(productId) {
      cart = cart.filter(item => item.productId !== productId);
      renderCart();
    }

    function renderCart() {
      const container = document.getElementById('cart-items');
      const summary = document.getElementById('cart-summary');

      if (cart.length === 0) {
        container.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 20px;">No items in cart</p>';
        summary.style.display = 'none';
        return;
      }

      container.innerHTML = cart.map(item => `
        <div class="cart-item">
          <div>
            <div style="font-weight: 500;">${item.productName}</div>
            <div style="font-size: 13px; color: var(--text-muted);">${item.quantity} × ${formatCurrency(item.price)}</div>
          </div>
          <div style="display: flex; align-items: center; gap: 12px;">
            <strong>${formatCurrency(item.total)}</strong>
            <button class="btn btn-sm btn-danger" onclick="removeFromCart('${item.productId}')">×</button>
          </div>
        </div>
      `).join('');

      const subtotal = cart.reduce((sum, item) => sum + item.total, 0);
      const tax = subtotal * 0.09;
      const total = subtotal + tax;

      document.getElementById('cart-subtotal').textContent = formatCurrency(subtotal);
      document.getElementById('cart-tax').textContent = formatCurrency(tax);
      document.getElementById('cart-total').textContent = formatCurrency(total);
      summary.style.display = 'block';
    }

    function createOrder() {
      const customerId = document.getElementById('sale-customer').value;
      if (!customerId) {
        showToast('Please select a customer');
        return;
      }
      if (cart.length === 0) {
        showToast('Cart is empty');
        return;
      }

      const customer = customers.find(c => c.id === customerId);
      const subtotal = cart.reduce((sum, item) => sum + item.total, 0);
      const tax = subtotal * 0.09;
      const total = subtotal + tax;

      const sale = {
        id: generateId('ORD'),
        customerId: customer.id,
        customerName: customer.name,
        items: [...cart],
        subtotal,
        tax,
        total,
        createdAt: new Date().toISOString()
      };

      // Update product quantities
      cart.forEach(item => {
        const product = products.find(p => p.id === item.productId);
        if (product) product.quantity -= item.quantity;
      });

      sales.push(sale);
      cart = [];
      renderCart();
      refreshData();
      showToast('Order created successfully!', 'success');
    }

    // Billing Functions
    function populateOrderDropdown() {
      const select = document.getElementById('invoice-order');
      select.innerHTML = '<option value="">Choose an order...</option>' + 
        sales.map(s => `<option value="${s.id}">${s.id} - ${s.customerName} - ${formatCurrency(s.total)}</option>`).join('');
    }

    function loadInvoice() {
      const orderId = document.getElementById('invoice-order').value;
      const container = document.getElementById('invoice-container');
      
      if (!orderId) {
        container.style.display = 'none';
        return;
      }

      const sale = sales.find(s => s.id === orderId);
      const customer = customers.find(c => c.id === sale.customerId);

      document.getElementById('inv-id').textContent = sale.id;
      document.getElementById('inv-date').textContent = formatDate(sale.createdAt);
      document.getElementById('inv-customer').innerHTML = `
        <div style="font-weight: 500;">${sale.customerName}</div>
        <div style="color: var(--text-muted);">${customer?.email || ''}</div>
        <div style="color: var(--text-muted);">${customer?.address || ''}</div>
      `;

      document.getElementById('inv-items').innerHTML = sale.items.map(item => `
        <tr>
          <td>${item.productName}</td>
          <td>${item.quantity}</td>
          <td>${formatCurrency(item.price)}</td>
          <td style="text-align: right;">${formatCurrency(item.total)}</td>
        </tr>
      `).join('');

      document.getElementById('inv-subtotal').textContent = formatCurrency(sale.subtotal);
      document.getElementById('inv-tax').textContent = formatCurrency(sale.tax);
      document.getElementById('inv-total').textContent = formatCurrency(sale.total);

      container.style.display = 'block';
    }

    function saveInvoice() {
      showToast('Invoice saved successfully!', 'success');
    }

    // Reports Functions
    function renderReports() {
      const totalSales = sales.reduce((sum, s) => sum + s.total, 0);
      const totalStock = products.reduce((sum, p) => sum + p.quantity, 0);

      document.getElementById('report-total-sales').textContent = formatCurrency(totalSales);
      document.getElementById('report-total-stock').textContent = totalStock;
      document.getElementById('report-total-orders').textContent = sales.length;

      // Customer-wise sales
      const customerSales = {};
      sales.forEach(sale => {
        if (!customerSales[sale.customerName]) {
          customerSales[sale.customerName] = { orders: 0, total: 0 };
        }
        customerSales[sale.customerName].orders++;
        customerSales[sale.customerName].total += sale.total;
      });

      document.getElementById('customer-sales-table').innerHTML = Object.entries(customerSales).map(([name, data]) => `
        <tr>
          <td>${name}</td>
          <td>${data.orders}</td>
          <td>${formatCurrency(data.total)}</td>
        </tr>
      `).join('') || '<tr><td colspan="3" style="text-align: center; color: var(--text-muted);">No sales data</td></tr>';

      // Stock summary
      document.getElementById('stock-summary-table').innerHTML = products.map(p => {
        let status = 'badge-success';
        let statusText = 'In Stock';
        if (p.quantity === 0) {
          status = 'badge-danger';
          statusText = 'Out of Stock';
        } else if (p.quantity < 10) {
          status = 'badge-warning';
          statusText = 'Low Stock';
        }
        return `
          <tr>
            <td>${p.name}</td>
            <td>${formatCurrency(p.price)}</td>
            <td>${p.quantity}</td>
            <td>${formatCurrency(p.price * p.quantity)}</td>
            <td><span class="badge ${status}">${statusText}</span></td>
          </tr>
        `;
      }).join('');
    }

    // Dashboard Functions
    function renderDashboard() {
      document.getElementById('stat-customers').textContent = customers.length;
      document.getElementById('stat-products').textContent = products.length;
      document.getElementById('stat-stock').textContent = products.reduce((sum, p) => sum + p.quantity, 0);
      document.getElementById('stat-revenue').textContent = formatCurrency(sales.reduce((sum, s) => sum + s.total, 0));

      // Recent sales
      document.getElementById('recent-sales-table').innerHTML = sales.slice(-5).reverse().map(s => `
        <tr>
          <td><strong>${s.id}</strong></td>
          <td>${s.customerName}</td>
          <td>${s.items.length} items</td>
          <td>${formatCurrency(s.total)}</td>
          <td>${formatDate(s.createdAt)}</td>
        </tr>
      `).join('') || '<tr><td colspan="5" style="text-align: center; color: var(--text-muted);">No sales yet</td></tr>';
    }

    // Refresh all data
    function refreshData() {
      fetchCustomers();  
      renderDashboard();
      renderCustomers();
      renderProducts();
      populateSalesDropdowns();
      populateOrderDropdown();
      renderReports();
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', refreshData);
  </script>
</body>
</html>
